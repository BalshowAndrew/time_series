# Вебинар 1. Знакомство с временными рядами

## Что такое временной ряд
**Временной ряд** - это значения какого-то признака, измеренные через **постоянные** временные интервалы

### Способы визуализации временных рядов
- Простой линейный график
- Ящик с усами (box plot)
- Свечи (candel plot)

### Вопросы к временным рядам
- Анализ (где мы находимся сейчас?)
- Прогноз (куда мы идем?)
- Поиск аномалий (где было что-то необычное?)

### Составляющие временного ряда
- **Тренд** - плавное долгосрочное изменение уровня ряда
- **Сезонность** - это циклические изменения уровня радя с постоянным периодом
- **Цикл** - это изменения уровня ряда с переменным периодом (экономические циклы, периоды солнечной активности)
    - Длина цикла должна быть постоянной
- **Ошибка** - это непрогнозируемая случайная компонента ряда (*эпсилон*)

>[!note] При отсчете времени прилипайте к знаковым числам: 7, 12, 24, 30, 60, 180, 365

## Автокорреляция (ACF)
**Автокорреляция** - это статистическая взаимосвязь (коэффициентк корреляции) между последовательностями величин одного ряда, взятыми со сдвигом (корреляция временного ряда с самим собой)

Посмотрим как связана продажа в текущем месяце и в следующем и построим диаграмму рассеяния. Для этого набираем координаты, проходя по графику окном размером 2. Полуяенная диаграмма рассеяния - это связь текущего месяца и следующего месяца (корреляция).

Если бы точки на графике лежали на прямой, проходящей под углом 45%, это означало бы, что значения текущего и предыдущего месяцев одинаковые.

Можно задавать значения сдвига (который называется **лаг** и обозначается греческой *тау*) разного размера: t + 1, t + 2, t + 3, ... и т.д. Сезонность равна значению лага, при котором автокорреляция ближе всего к 1.

### Коррелограмма
По оси x расположено значения лага, а по оси y - значение автокорреляции. Значение по оси x самого большого пика соответствует значеняю сезонности.
[Пример коррелограммы](http://www.machinelearning.ru/wiki/index.php?title=%D0%9A%D0%BE%D1%80%D1%80%D0%B5%D0%BB%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0)

### Частичная автокорреляция (PACF):
определяется как знаяение коэффициента корреляции между случайными величинами x(t) и x(t+k), очищенными от влияния "промежуточных" случайных величин x(t+1), ..., x(t+k-1).

## Стационарность
Каждый временной ряд, который будет подан на вход, мы будем стараться привести к стационарному виду.

**Почему**?
1. Стационарный ряд легче предсказывать. Можно предположить, что статистические свойства в будущем не изменятся.
2. В большинстве моделей рядов закладывается гимотеза о стационарности. Это означает, что получаемые оценки будут надежными только в случае стационарности ряда.

Статистические свойства стационарных рядов, такие как: мат. ожидание и дисперсия, не зависят от времени.

Визуально стационарный ряд похож на шум.

### Строгая стационарность
Ряд **y(t)** называется строго стационарным, если для любого **s** совместное распределение вероятностей **y(t), y(t+1), ..., y(t+k)** совпадает с совметным распределением вероятностей **y(t+s), y(t+s+1), ..., y(t+s+k)**

**k** - размер промежутка

### Слабая стационарность
Ряд **y(t)** называется слабо стационарным если **E(y(t))=const** и **cov(y(t), y(t+s))** зависит только от **s**

>[!note] Всякий строго стационарный ряд так же и слабо стационарен

### Как сделать ряд стационарным?
1. **Логарифмирование** (для рядов с монотонно меняющейся дисперсией)
    - прижимает ряд к оси x;
    - выравнивает дисперсию.
2. **Дифферецирование** -  переход к попарным разностям:
    - y^(t) = y(t) - y(t-1) - дифференцирование с **лагом = 1**;
    - позволяет избавиться от тренда;
    - в продифференцированном временном ряде количество элементов станет меньше на число, равное величине лага.

>[!note] Дифференцирование с лагом равным размеру сезонности уберет эту сезонность

3. Временной рад можно **дифференцировать** несколько раз с **разными значениями лагов**

## Авторегрессия
Пытается предсказать ряд по его же наблюдениям в прошлом

**y = AR(3)** - модель авторегрессии третьего порядка:

**y(t)** = a + b1\*y(t-1) + b2\*y(t-2) + b3\*y(t-3) + *epsilon(t)*

## Тест Дики-Фуллера
Проверяем гипотезу не стационарности против стационарности

## Способы определения стационарных рядов
- Визуально похож ли график на шум.
- Визуально на графике привести контр-примеры с двумя интервалами.
- Если во временном ряде автокорреляция (коррелограмме) равномерно снижается, то это нестационарный ряд.
- Если автокорреляция падает резко, то это стационарный ряд.
- Тест Дики-Фуллура

>[!note] Для проверки на стационарность рекомендуется комбинировать ДФ и визуальные методы.


